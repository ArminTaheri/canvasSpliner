// Build date: 2017-0529T14:23:39

/*
* Author    Jonathan Lurie - http://me.jonathanlurie.fr
* License   MIT
* Link      https://github.com/jonathanlurie/canvasSpliner
* Lab       MCIN - http://mcin.ca/ - Montreal Neurological Institute
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(d,n,g){if(g.get||g.set)throw new TypeError("ES3 does not support getters and setters.");d!=Array.prototype&&d!=Object.prototype&&(d[n]=g.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(d,n,g,k){if(n){g=$jscomp.global;d=d.split(".");for(k=0;k<d.length-1;k++){var b=d[k];b in g||(g[b]={});g=g[b]}d=d[d.length-1];k=g[d];n=n(k);n!=k&&null!=n&&$jscomp.defineProperty(g,d,{configurable:!0,writable:!0,value:n})}};$jscomp.polyfill("Array.prototype.fill",function(d){return d?d:function(d,g,k){var b=this.length||0;0>g&&(g=Math.max(0,b+g));if(null==k||k>b)k=b;k=Number(k);0>k&&(k=Math.max(0,b+k));for(g=Number(g||0);g<k;g++)this[g]=d;return this}},"es6-impl","es3");
(function(d,n){"object"===typeof exports&&"undefined"!==typeof module?n(exports):"function"===typeof define&&define.amd?define(["exports"],n):n(d.pixpipeUI=d.pixpipeUI||{})})(this,function(d){var n;n=function(){function a(a,m){var c,k,q,d,f,b,t,e,l,h,g;t=a.length;q=[];b=[];c=[];k=[];d=[];e=[];f=0;for(l=t-1;0<=l?f<l:f>l;0<=l?f+=1:--f)q[f]=(m[f+1]-m[f])/(a[f+1]-a[f]),0<f&&(b[f]=(q[f-1]+q[f])/2);b[0]=q[0];b[t-1]=q[t-2];l=[];f=0;for(h=t-1;0<=h?f<h:f>h;0<=h?f+=1:--f)0===q[f]&&l.push(f);h=0;for(g=l.length;h<
g;h++)f=l[h],b[f]=b[f+1]=0;f=0;for(l=t-1;0<=l?f<l:f>l;0<=l?f+=1:--f)c[f]=b[f]/q[f],k[f]=b[f+1]/q[f],d[f]=Math.pow(c[f],2)+Math.pow(k[f],2),e[f]=3/Math.sqrt(d[f]);l=[];f=0;for(h=t-1;0<=h?f<h:f>h;0<=h?f+=1:--f)9<d[f]&&l.push(f);d=0;for(h=l.length;d<h;d++)f=l[d],b[f]=e[f]*c[f]*q[f],b[f+1]=e[f]*k[f]*q[f];this.x=a.slice(0,t);this.y=m.slice(0,t);this.m=b}a.prototype.interpolate=function(a){var c,p,d,b;for(p=c=this.x.length-2;(0>=c?0>=p:0<=p)&&!(this.x[p]<=a);0>=c?p+=1:--p);c=this.x[p+1]-this.x[p];a=(a-
this.x[p])/c;d=Math.pow(a,2);b=Math.pow(a,3);return(2*b-3*d+1)*this.y[p]+(b-2*d+a)*c*this.m[p]+(-2*b+3*d)*this.y[p+1]+(b-d)*c*this.m[p+1]};return a}();var g=function(){function a(a,m,p,d){var c,b,f,k,g,e,l,h,n,u,r;if(null!=a&&null!=m){f=null!=p&&null!=d;h=a.length-1;g=[];u=[];l=[];n=[];r=[];b=[];c=[];k=[];for(e=0;0<=h?e<h:e>h;0<=h?e+=1:--e)g[e]=a[e+1]-a[e];f&&(u[0]=3*(m[1]-m[0])/g[0]-3*p,u[h]=3*d-3*(m[h]-m[h-1])/g[h-1]);for(e=1;1<=h?e<h:e>h;1<=h?e+=1:--e)u[e]=3/g[e]*(m[e+1]-m[e])-3/g[e-1]*(m[e]-m[e-
1]);f?(l[0]=2*g[0],n[0]=.5,r[0]=u[0]/l[0]):(l[0]=1,n[0]=0,r[0]=0);for(e=1;1<=h?e<h:e>h;1<=h?e+=1:--e)l[e]=2*(a[e+1]-a[e-1])-g[e-1]*n[e-1],n[e]=g[e]/l[e],r[e]=(u[e]-g[e-1]*r[e-1])/l[e];f?(l[h]=g[h-1]*(2-n[h-1]),r[h]=(u[h]-g[h-1]*r[h-1])/l[h],b[h]=r[h]):(l[h]=1,r[h]=0,b[h]=0);for(e=p=h-1;0>=p?0>=e:0<=e;0>=p?e+=1:--e)b[e]=r[e]-n[e]*b[e+1],c[e]=(m[e+1]-m[e])/g[e]-g[e]*(b[e+1]+2*b[e])/3,k[e]=(b[e+1]-b[e])/(3*g[e]);this.x=a.slice(0,h+1);this.a=m.slice(0,h);this.b=c;this.c=b.slice(0,h);this.d=k}}a.prototype.derivative=
function(){var a,m,b,d,g;m=new this.constructor;m.x=this.x.slice(0,this.x.length);m.a=this.b.slice(0,this.b.length);g=this.c;b=0;for(d=g.length;b<d;b++)a=g[b],m.b=2*a;g=this.d;b=0;for(d=g.length;b<d;b++)a=g[b],m.c=3*a;a=0;for(b=this.d.length;0<=b?a<b:a>b;0<=b?a+=1:--a)m.d=0;return m};a.prototype.interpolate=function(a){var c,b;for(c=b=this.x.length-1;(0>=b?0>=c:0<=c)&&!(this.x[c]<=a);0>=b?c+=1:--c);a-=this.x[c];return this.a[c]+this.b[c]*a+this.c[c]*Math.pow(a,2)+this.d[c]*Math.pow(a,3)};return a}(),
k=function(){this._points=[];this._min={x:0,y:0};this._max={x:Infinity,y:Infinity}};k.prototype.setBoundary=function(a,c,b){this["_"+a][c]=b};k.prototype.add=function(a){var c=null;a.x>=this._min.x&&a.x<=this._max.x&&a.y>=this._min.y&&a.y<=this._max.y&&("xLocked"in a||(a.xLocked=!1),"yLocked"in a||(a.yLocked=!1),"safe"in a||(a.safe=!1),this._points.push(a),this._sortPoints(),c=this._points.indexOf(a));return c};k.prototype._sortPoints=function(){this._points.sort(function(a,c){return a.x-c.x})};k.prototype.remove=
function(a){var c=null;0<=a&&a<this._points.length&&!this._points[a].safe&&(c=this._points.splice(a,1));return c};k.prototype.getClosestFrom=function(a){if(!this._points.length)return null;for(var c=Infinity,b=null,d=0;d<this._points.length;d++){var g=Math.sqrt(Math.pow(a.x-this._points[d].x,2)+Math.pow(a.y-this._points[d].y,2));g<c&&(c=g,b=d)}return{index:b,distance:c}};k.prototype.getPoint=function(a){return 0<a&&a<this._points.length?this._points[a]:null};k.prototype.getNumberOfPoints=function(){return this._points.length};
k.prototype.updatePoint=function(a,c){var b=a;0<=a&&a<this._points.length&&c.x>=this._min.x&&c.x<this._max.x&&c.y>=this._min.y&&c.y<this._max.y&&(this._points[a].xLocked||(this._points[a].x=c.x),this._points[a].yLocked||(this._points[a].y=c.y),a=this._points[a],this._sortPoints(),b=this._points.indexOf(a));return b};k.prototype.getXseries=function(){for(var a=[],c=0;c<this._points.length;c++)a.push(this._points[c].x);return a};k.prototype.getYseries=function(){for(var a=[],c=0;c<this._points.length;c++)a.push(this._points[c].y);
return a};var b=function(a,c,b,d){d=void 0===d?"natural":d;this._borderStyle={in:"1px solid #d3d3ff",out:"1px solid #e3e3e3"};this._controlPointRadius={idle:6,grabed:12};this._controlPointStyle={idle:"rgba(255, 0, 0, 0.5)",hovered:"rgba(0, 0, 255, 0.5)",grabed:"rgba(0, 200, 0, 0.5)"};this._curveStyle={idle:"rgba(0, 128, 255, 1)",moving:"rgba(255, 128, 0, 1)"};this._curveThickness={idle:1,moving:2};this._mouse=null;this._pointGrabedIndex=this._pointHoveredIndex=-1;this._mouseDown=!1;this._ctx=this._canvas=
null;this._screenRatio=window.devicePixelRatio;if(a=document.getElementById(a))this._canvas=document.createElement("canvas"),this._canvas.width=c,this._canvas.height=b,this._canvas.setAttribute("tabIndex",1),this._canvas.style.outline="none",this._canvas.style.cursor="default",this._canvas.style.border=this._borderStyle.out,this._canvas.onselectstart=function(){return!1},this._width=c,this._height=b,a.appendChild(this._canvas),this._ctx=this._canvas.getContext("2d"),this._ctx.scale(this._screenRatio,
this._screenRatio),this._canvas.addEventListener("mousemove",this._onCanvasMouseMove.bind(this),!1),this._canvas.addEventListener("mousedown",this._onCanvasMouseDown.bind(this),!1),this._canvas.addEventListener("mouseup",this._onCanvasMouseUp.bind(this),!1),this._canvas.addEventListener("dblclick",this._onCanvasMouseDbclick.bind(this),!1),this._canvas.addEventListener("mouseleave",this._onCanvasMouseLeave.bind(this),!1),this._canvas.addEventListener("mouseenter",this._onCanvasMouseEnter.bind(this),
!1),this._canvas.addEventListener("keyup",this._onKeyUp.bind(this),!1),this._splineContructor=g,"monotonic"===d&&(this._splineContructor=n),this._pointCollection=new k,this._pointCollection.setBoundary("max","x",c),this._pointCollection.setBoundary("max","y",b)};b.prototype.setSplineType=function(a){this._splineContructor=monot_spline.CubicSpline;"monotonic"===a&&(this._splineContructor=monot_spline.MonotonicCubicSpline)};b.prototype._updateMousePosition=function(a){var b=this._canvas.getBoundingClientRect();
this._mouse={x:a.clientX-b.left,y:this._height-(a.clientY-b.top)}};b.prototype._onCanvasMouseMove=function(a){this._updateMousePosition(a);a=this._pointCollection.getClosestFrom(this._mouse);this._pointHoveredIndex=-1==this._pointGrabedIndex?a.distance<=this._controlPointRadius.idle?a.index:-1:this._pointGrabedIndex=this._pointCollection.updatePoint(this._pointGrabedIndex,this._mouse);this.draw()};b.prototype._onCanvasMouseDown=function(a){console.log("down ");this._mouseDown=!0;-1!=this._pointHoveredIndex&&
(console.log("grabing a point"),this._pointGrabedIndex=this._pointHoveredIndex);this.draw()};b.prototype._onCanvasMouseUp=function(a){console.log("up ");this._mouseDown=!1;this._pointGrabedIndex=-1;this.draw()};b.prototype._onCanvasMouseDbclick=function(a){console.log("dbclick");this._canvas.focus();-1==this._pointHoveredIndex?this._pointHoveredIndex=this.add({x:this._mouse.x/this._width,y:this._mouse.y/this._height}):(this.remove(this._pointHoveredIndex),this._pointGrabedIndex=this._pointHoveredIndex=
-1)};b.prototype._onCanvasMouseLeave=function(a){this._mouse=null;console.log("leave");this._canvas.blur();this._canvas.style.border=this._borderStyle.out;this._mouseDown=!1;this._pointHoveredIndex=this._pointGrabedIndex=-1;this.draw()};b.prototype._onCanvasMouseEnter=function(a){console.log("enter");this._canvas.focus();this._canvas.style.border=this._borderStyle.in};b.prototype._onKeyUp=function(a){if(this._mouse)switch(console.log("pressed: "+a.key),a.key){case "d":this.remove(this._pointHoveredIndex)}};
b.prototype.add=function(a,b){b=void 0===b?!0:b;var c=null;"x"in a&&"y"in a&&(a.x*=this._width,a.y*=this._height,c=this._pointCollection.add(a),console.log("a point is added"));b&&this.draw();return c};b.prototype.remove=function(a){this._pointCollection.remove(a);this.draw()};b.prototype.draw=function(){this._ctx.clearRect(0,0,this._width,this._height);this._drawData()};b.prototype._drawData=function(a,b){a=void 0===a?!0:a;b=void 0===b?!0:b;var c=this._pointCollection.getXseries(),d=this._pointCollection.getYseries();
if(c.length){if(a){this._ctx.beginPath();this._ctx.moveTo(c[0]/this._screenRatio,(this._height-d[0])/this._screenRatio);this._splineContructor;a=new this._splineContructor(c,d);for(var g=c[0];g<c[c.length-1];g++){var k=a.interpolate(g),k=0>k?.5:k>this._height?this._height-.5:k;this._ctx.lineTo(g/this._screenRatio,(this._height-k)/this._screenRatio)}this._ctx.strokeStyle=this._curveStyle.idle;this._ctx.lineWidth=this._curveThickness.idle/this._screenRatio;this._ctx.stroke();this._ctx.closePath()}if(b)for(b=
0;b<c.length;b++)this._ctx.beginPath(),this._ctx.arc(c[b]/this._screenRatio,(this._height-d[b])/this._screenRatio,this._controlPointRadius.idle/this._screenRatio,0,2*Math.PI),this._ctx.fillStyle=-1==this._pointHoveredIndex?this._controlPointStyle.idle:b==this._pointHoveredIndex?this._mouseDown?this._controlPointStyle.grabed:this._controlPointStyle.hovered:this._controlPointStyle.idle,this._ctx.fill(),this._ctx.closePath()}};b.prototype.getValue=function(a){var b=this._pointCollection.getXseries(),
d=this._pointCollection.getYseries();return(new this._splineContructor(b,d)).interpolate(a)};d.CanvasSpliner=b;Object.defineProperty(d,"__esModule",{value:!0})});
