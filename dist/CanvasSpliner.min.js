// Build date: 2017-0530T15:49:42

/*
* Author    Jonathan Lurie - http://me.jonathanlurie.fr
* License   MIT
* Link      https://github.com/jonathanlurie/canvasSpliner
* Lab       MCIN - http://mcin.ca/ - Montreal Neurological Institute
*/
var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(e,n,l){if(l.get||l.set)throw new TypeError("ES3 does not support getters and setters.");e!=Array.prototype&&e!=Object.prototype&&(e[n]=l.value)};$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(e,n,l,d){if(n){l=$jscomp.global;e=e.split(".");for(d=0;d<e.length-1;d++){var b=e[d];b in l||(l[b]={});l=l[b]}e=e[e.length-1];d=l[e];n=n(d);n!=d&&null!=n&&$jscomp.defineProperty(l,e,{configurable:!0,writable:!0,value:n})}};$jscomp.polyfill("Array.prototype.fill",function(e){return e?e:function(e,l,d){var b=this.length||0;0>l&&(l=Math.max(0,b+l));if(null==d||d>b)d=b;d=Number(d);0>d&&(d=Math.max(0,b+d));for(l=Number(l||0);l<d;l++)this[l]=e;return this}},"es6-impl","es3");
(function(e,n){"object"===typeof exports&&"undefined"!==typeof module?n(exports):"function"===typeof define&&define.amd?define(["exports"],n):n(e.pixpipeUI=e.pixpipeUI||{})})(this,function(e){var n;n=function(){function a(a,p){var c,q,k,b,g,d,e,f,m,h,l;e=a.length;k=[];d=[];c=[];q=[];b=[];f=[];g=0;for(m=e-1;0<=m?g<m:g>m;0<=m?g+=1:--g)k[g]=(p[g+1]-p[g])/(a[g+1]-a[g]),0<g&&(d[g]=(k[g-1]+k[g])/2);d[0]=k[0];d[e-1]=k[e-2];m=[];g=0;for(h=e-1;0<=h?g<h:g>h;0<=h?g+=1:--g)0===k[g]&&m.push(g);h=0;for(l=m.length;h<
l;h++)g=m[h],d[g]=d[g+1]=0;g=0;for(m=e-1;0<=m?g<m:g>m;0<=m?g+=1:--g)c[g]=d[g]/k[g],q[g]=d[g+1]/k[g],b[g]=Math.pow(c[g],2)+Math.pow(q[g],2),f[g]=3/Math.sqrt(b[g]);m=[];g=0;for(h=e-1;0<=h?g<h:g>h;0<=h?g+=1:--g)9<b[g]&&m.push(g);b=0;for(h=m.length;b<h;b++)g=m[b],d[g]=f[g]*c[g]*k[g],d[g+1]=f[g]*q[g]*k[g];this.x=a.slice(0,e);this.y=p.slice(0,e);this.m=d}a.prototype.interpolate=function(a){var c,r,b,k;for(r=c=this.x.length-2;(0>=c?0>=r:0<=r)&&!(this.x[r]<=a);0>=c?r+=1:--r);c=this.x[r+1]-this.x[r];a=(a-
this.x[r])/c;b=Math.pow(a,2);k=Math.pow(a,3);return(2*k-3*b+1)*this.y[r]+(k-2*b+a)*c*this.m[r]+(-2*k+3*b)*this.y[r+1]+(k-b)*c*this.m[r+1]};return a}();var l=function(){function a(a,p,r,b){var c,d,g,e,q,f,m,h,l,n,t;if(null!=a&&null!=p){g=null!=r&&null!=b;h=a.length-1;q=[];n=[];m=[];l=[];t=[];d=[];c=[];e=[];for(f=0;0<=h?f<h:f>h;0<=h?f+=1:--f)q[f]=a[f+1]-a[f];g&&(n[0]=3*(p[1]-p[0])/q[0]-3*r,n[h]=3*b-3*(p[h]-p[h-1])/q[h-1]);for(f=1;1<=h?f<h:f>h;1<=h?f+=1:--f)n[f]=3/q[f]*(p[f+1]-p[f])-3/q[f-1]*(p[f]-p[f-
1]);g?(m[0]=2*q[0],l[0]=.5,t[0]=n[0]/m[0]):(m[0]=1,l[0]=0,t[0]=0);for(f=1;1<=h?f<h:f>h;1<=h?f+=1:--f)m[f]=2*(a[f+1]-a[f-1])-q[f-1]*l[f-1],l[f]=q[f]/m[f],t[f]=(n[f]-q[f-1]*t[f-1])/m[f];g?(m[h]=q[h-1]*(2-l[h-1]),t[h]=(n[h]-q[h-1]*t[h-1])/m[h],d[h]=t[h]):(m[h]=1,t[h]=0,d[h]=0);for(f=r=h-1;0>=r?0>=f:0<=f;0>=r?f+=1:--f)d[f]=t[f]-l[f]*d[f+1],c[f]=(p[f+1]-p[f])/q[f]-q[f]*(d[f+1]+2*d[f])/3,e[f]=(d[f+1]-d[f])/(3*q[f]);this.x=a.slice(0,h+1);this.a=p.slice(0,h);this.b=c;this.c=d.slice(0,h);this.d=e}}a.prototype.derivative=
function(){var a,p,b,d,k;p=new this.constructor;p.x=this.x.slice(0,this.x.length);p.a=this.b.slice(0,this.b.length);k=this.c;b=0;for(d=k.length;b<d;b++)a=k[b],p.b=2*a;k=this.d;b=0;for(d=k.length;b<d;b++)a=k[b],p.c=3*a;a=0;for(b=this.d.length;0<=b?a<b:a>b;0<=b?a+=1:--a)p.d=0;return p};a.prototype.interpolate=function(a){var c,b;for(c=b=this.x.length-1;(0>=b?0>=c:0<=c)&&!(this.x[c]<=a);0>=b?c+=1:--c);a-=this.x[c];return this.a[c]+this.b[c]*a+this.c[c]*Math.pow(a,2)+this.d[c]*Math.pow(a,3)};return a}(),
d=function(){this._points=[];this._min={x:0,y:0};this._max={x:Infinity,y:Infinity}};d.prototype.setBoundary=function(a,c,b){this["_"+a][c]=b};d.prototype.add=function(a){var c=null;a.x>=this._min.x&&a.x<=this._max.x&&a.y>=this._min.y&&a.y<=this._max.y&&("xLocked"in a||(a.xLocked=!1),"yLocked"in a||(a.yLocked=!1),"safe"in a||(a.safe=!1),this._points.push(a),this._sortPoints(),c=this._points.indexOf(a));return c};d.prototype._sortPoints=function(){this._points.sort(function(a,c){return a.x-c.x})};d.prototype.remove=
function(a){var c=null;0<=a&&a<this._points.length&&!this._points[a].safe&&(c=this._points.splice(a,1));return c};d.prototype.getClosestFrom=function(a){if(!this._points.length)return null;for(var c=Infinity,b=null,d=0;d<this._points.length;d++){var q=Math.sqrt(Math.pow(a.x-this._points[d].x,2)+Math.pow(a.y-this._points[d].y,2));q<c&&(c=q,b=d)}return{index:b,distance:c}};d.prototype.getPoint=function(a){return 0<=a&&a<this._points.length?this._points[a]:null};d.prototype.getNumberOfPoints=function(){return this._points.length};
d.prototype.updatePoint=function(a,c){var b=a;0<=a&&a<this._points.length&&c.x>=this._min.x&&c.x<this._max.x&&c.y>=this._min.y&&c.y<this._max.y&&(this._points[a].xLocked||(this._points[a].x=c.x),this._points[a].yLocked||(this._points[a].y=c.y),a=this._points[a],this._sortPoints(),b=this._points.indexOf(a));return b};d.prototype.getXseries=function(){for(var a=[],c=0;c<this._points.length;c++)a.push(this._points[c].x);return a};d.prototype.getYseries=function(){for(var a=[],c=0;c<this._points.length;c++)a.push(this._points[c].y);
return a};var b=function(a,c,b,e){e=void 0===e?"natural":e;this._borderStyle={in:"1px solid #d3d3ff",out:"1px solid #e3e3e3"};this._controlPointRadius=8;this._controlPointColor={idle:"rgba(244, 66, 167, 0.5)",hovered:"rgba(0, 0, 255, 0.5)",grabbed:"rgba(0, 200, 0, 0.5)"};this._curveColor={idle:"rgba(0, 128, 255, 1)",moving:"rgba(255, 128, 0, 1)"};this._gridColor="rgba(0, 0, 0, 0.3)";this._textColor="rgba(0, 0, 0, 0.1)";this._curveThickness=1;this._backgroundColor=!1;this._mouse=null;this._pointGrabbedIndex=
this._pointHoveredIndex=-1;this._mouseDown=!1;this._ctx=this._canvas=null;this._screenRatio=window.devicePixelRatio;if(a=document.getElementById(a))this._canvas=document.createElement("canvas"),this._canvas.width=c,this._canvas.height=b,this._canvas.setAttribute("tabIndex",1),this._canvas.style.outline="none",this._canvas.style.cursor="default",this._canvas.style.border=this._borderStyle.out,this._canvas.onselectstart=function(){return!1},this._width=c,this._height=b,a.appendChild(this._canvas),this._ctx=
this._canvas.getContext("2d"),this._ctx.scale(this._screenRatio,this._screenRatio),this._canvas.addEventListener("mousemove",this._onCanvasMouseMove.bind(this),!1),this._canvas.addEventListener("mousedown",this._onCanvasMouseDown.bind(this),!1),this._canvas.addEventListener("mouseup",this._onCanvasMouseUp.bind(this),!1),this._canvas.addEventListener("dblclick",this._onCanvasMouseDbclick.bind(this),!1),this._canvas.addEventListener("mouseleave",this._onCanvasMouseLeave.bind(this),!1),this._canvas.addEventListener("mouseenter",
this._onCanvasMouseEnter.bind(this),!1),this._canvas.addEventListener("keyup",this._onKeyUp.bind(this),!1),this._splineConstructor=l,"monotonic"===e&&(this._splineConstructor=n),this._pointCollection=new d,this._pointCollection.setBoundary("max","x",c),this._pointCollection.setBoundary("max","y",b),this._xSeriesInterpolated=Array(this._width).fill(0),this._ySeriesInterpolated=Array(this._width).fill(0),this._gridStep=1/3,this._onEvents={move:null,released:null},this.draw()};b.prototype.getXSeriesInterpolated=
function(){return this._xSeriesInterpolated};b.prototype.getYSeriesInterpolated=function(){return this._ySeriesInterpolated};b.prototype.setControlPointRadius=function(a){this._controlPointRadius=a};b.prototype.setControlPointColor=function(a,c){this._controlPointColor[a]=c};b.prototype.setCurveColor=function(a,c){this._curveColor[a]=c};b.prototype.setGridColor=function(a){this._gridColor=a};b.prototype.setGridStep=function(a){this._gridStep=0>=a||1<=a?0:a;this.draw()};b.prototype.setTextColor=function(a){this._textColor=
a};b.prototype.setCurveThickness=function(a){this._curveThickness=a};b.prototype.setBackgroundColor=function(a){this._backgroundColor=a};b.prototype.setSplineType=function(a){this._splineConstructor="monotonic"===a?n:l};b.prototype._updateMousePosition=function(a){var c=this._canvas.getBoundingClientRect();this._mouse={x:a.clientX-c.left,y:this._height-(a.clientY-c.top)}};b.prototype._onCanvasMouseMove=function(a){this._updateMousePosition(a);if(a=this._pointCollection.getClosestFrom(this._mouse))-1==
this._pointGrabbedIndex?a.distance<=this._controlPointRadius?this._pointHoveredIndex=a.index:(a=!1,-1!=this._pointHoveredIndex&&(a=!0),this._pointHoveredIndex=-1,a&&this.draw()):this._pointHoveredIndex=this._pointGrabbedIndex=this._pointCollection.updatePoint(this._pointGrabbedIndex,this._mouse),-1==this._pointHoveredIndex&&-1==this._pointGrabbedIndex||this.draw(),-1!=this._pointGrabbedIndex&&(a=this._pointCollection.getPoint(this._pointGrabbedIndex),this._drawCoordinates(Math.round(a.x/this._width*
1E3)/1E3,Math.round(a.y/this._height*1E3)/1E3),this._onEvents.move&&this._onEvents.move(this._xSeriesInterpolated,this._ySeriesInterpolated))};b.prototype._onCanvasMouseDown=function(a){console.log("down ");this._mouseDown=!0;-1!=this._pointHoveredIndex&&(console.log("grabing a point"),this._pointGrabbedIndex=this._pointHoveredIndex)};b.prototype._onCanvasMouseUp=function(a){console.log("up ");a=-1!=this._pointGrabbedIndex;this._mouseDown=!1;this._pointGrabbedIndex=-1;this.draw();this._onEvents.released&&
a&&this._onEvents.released(this._xSeriesInterpolated,this._ySeriesInterpolated)};b.prototype._onCanvasMouseDbclick=function(a){console.log("dbclick");this._canvas.focus();-1==this._pointHoveredIndex?this._pointHoveredIndex=this.add({x:this._mouse.x/this._width,y:this._mouse.y/this._height}):(this.remove(this._pointHoveredIndex),this._pointGrabbedIndex=this._pointHoveredIndex=-1)};b.prototype._onCanvasMouseLeave=function(a){this._mouse=null;console.log("leave");this._canvas.blur();this._canvas.style.border=
this._borderStyle.out;this._mouseDown=!1;this._pointHoveredIndex=this._pointGrabbedIndex=-1;this.draw()};b.prototype._onCanvasMouseEnter=function(a){console.log("enter");this._canvas.focus();this._canvas.style.border=this._borderStyle.in};b.prototype._onKeyUp=function(a){if(this._mouse)switch(console.log("pressed: "+a.key),a.key){case "d":this.remove(this._pointHoveredIndex)}};b.prototype.add=function(a,c){c=void 0===c?!0:c;var b=null;"x"in a&&"y"in a&&(a.x*=this._width,a.y*=this._height,b=this._pointCollection.add(a),
console.log("a point is added"));c&&this.draw();return b};b.prototype.remove=function(a){this._pointCollection.remove(a);this.draw()};b.prototype.draw=function(){this._ctx.clearRect(0,0,this._width,this._height);this._fillBackground();this._drawGrid();this._drawData()};b.prototype._fillBackground=function(){this._backgroundColor&&(this._ctx.beginPath(),this._ctx.rect(0,0,this._width,this._height),this._ctx.fillStyle=this._backgroundColor,this._ctx.fill())};b.prototype._drawCoordinates=function(a,
c){var b=14/this._screenRatio;this._ctx.fillStyle=this._textColor;this._ctx.font=b+"px courier";this._ctx.fillText("x: "+a,10/this._screenRatio,20/this._screenRatio);this._ctx.fillText("y: "+c,10/this._screenRatio,35/this._screenRatio)};b.prototype._drawGrid=function(){var a=this._gridStep;if(0!=a){this._ctx.beginPath();this._ctx.moveTo(0,0);for(var c=a*this._height/this._screenRatio;c<this._height/this._screenRatio;c+=a*this._height/this._screenRatio)this._ctx.moveTo(0,c+.5/this._screenRatio),this._ctx.lineTo(this._width,
c+.5/this._screenRatio);this._ctx.moveTo(0,0);for(c=a*this._width/this._screenRatio;c<this._width/this._screenRatio;c+=a*this._width/this._screenRatio)this._ctx.moveTo(c+.5/this._screenRatio,0),this._ctx.lineTo(c+.5/this._screenRatio,this._height);this._ctx.strokeStyle=this._gridColor;this._ctx.lineWidth=.5;this._ctx.stroke();this._ctx.closePath()}};b.prototype._drawData=function(a,c){a=void 0===a?!0:a;c=void 0===c?!0:c;var b=this._pointCollection.getXseries(),d=this._pointCollection.getYseries();
if(b.length){if(a){console.log("draw curve");this._ctx.beginPath();this._ctx.moveTo(b[0]/this._screenRatio,(this._height-d[0])/this._screenRatio);a=new this._splineConstructor(b,d);this._xSeriesInterpolated.fill(0);this._ySeriesInterpolated.fill(0);for(var e=0;e<Math.ceil(b[0]);e++){var k=d[0];this._xSeriesInterpolated[e]=e/this._width;this._ySeriesInterpolated[e]=k/this._height;k=0>k?.5:k>this._height?this._height-.5:k;this._ctx.lineTo(e/this._screenRatio,(this._height-k)/this._screenRatio)}for(e=
Math.ceil(b[0]);e<Math.ceil(b[b.length-1]);e++)k=a.interpolate(e),this._xSeriesInterpolated[e]=e/this._width,this._ySeriesInterpolated[e]=k/this._height,k=0>k?.5:k>this._height?this._height-.5:k,this._ctx.lineTo(e/this._screenRatio,(this._height-k)/this._screenRatio);for(e=Math.ceil(b[b.length-1]);e<this._width;e++)k=d[d.length-1],this._xSeriesInterpolated[e]=e/this._width,this._ySeriesInterpolated[e]=k/this._height,k=0>k?.5:k>this._height?this._height-.5:k,this._ctx.lineTo(e/this._screenRatio,(this._height-
k)/this._screenRatio);this._ctx.strokeStyle=-1==this._pointGrabbedIndex?this._curveColor.idle:this._curveColor.moving;this._ctx.lineWidth=this._curveThickness/this._screenRatio;this._ctx.stroke();this._ctx.closePath()}if(c)for(c=0;c<b.length;c++)this._ctx.beginPath(),this._ctx.arc(b[c]/this._screenRatio,(this._height-d[c])/this._screenRatio,this._controlPointRadius/this._screenRatio,0,2*Math.PI),this._ctx.fillStyle=-1==this._pointHoveredIndex?this._controlPointColor.idle:c==this._pointHoveredIndex?
this._mouseDown?this._controlPointColor.grabbed:this._controlPointColor.hovered:this._controlPointColor.idle,this._ctx.fill(),this._ctx.closePath()}};b.prototype.getValue=function(a){var b=this._pointCollection.getXseries(),d=this._pointCollection.getYseries();return a<=b[0]/this._width?d[0]/this._height:a>=b[b.length-1]/this._width?d[d.length-1]/this._height:(new this._splineConstructor(b,d)).interpolate(a*this._width)/this._height};b.prototype.on=function(a,b){this._onEvents[a]=b};e.CanvasSpliner=
b;Object.defineProperty(e,"__esModule",{value:!0})});
